<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="description" content="Update Portfolio">
    <meta name="keywords" content="Update Portfolio Page, Oracle">
    <meta name="author" content="Uddhav Grover"/>
    <title>Register New Investment Details</title>

        <!-- Bootstrap CSS -->
        <link
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
        rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
        crossorigin="anonymous"
      />
  
      <!-- CSS Applied -->
      <link rel="stylesheet" href="./styles/styles.css" />

</head>

<body>
  <header>
      <nav
        class="navbar navbar-expand-lg navbar-dark"
        style="background-color: #394867"
      >
        <div class="container-fluid">
          <button
            class="navbar-toggler"
            type="button"
            data-bs-toggle="collapse"
            data-bs-target="#navigator"
            aria-controls="navigator"
            aria-expanded="true"
            aria-label="Toggle navigation"
          >
            <span class="navbar-toggler-icon"></span>
          </button>
          <a class="navbar-brand" href="./index.html">
            <img
              src="./AWS.png"
              alt="Logo"
              class="d-inline-block align-text-center brand-logo"
            />
          </a>
          <div class="collapse navbar-collapse" id="navigator">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
              <li class="nav-item">
                <a class="nav-link" href="./clientDetails.php"
                  >Client Details</a
                >
              </li>
              <li class="nav-item">
                <a class="nav-link" href="./clientReg.php"
                  >Register New Client</a
                >
              </li>
              <li class="nav-item">
                <a class="nav-link" href="./UpdateClientDetails.html"
                  >Update Client</a
                >
              </li>
              <li class="nav-item">
                <a class="nav-link" href="./portfolioReg.php"
                  >Update Client Portfolio</a
                >
              </li>
            </ul>
          </div>
        </div>
      </nav>
    </header>

    <form method="post" action="" style="margin:100px">
    <h1>Portfolio Search and Edit</h1>
		<label for="client-id">Enter Client ID:</label>
		<input type="text" name="client-id" id="client-id" required>
		<input type="submit" name="search" value="Search">
	</form>
	<form method="post" action="" style="margin:50px">
    <h1>Client Search and Edit</h1>
		<label for="client-id">Enter Client ID:</label>
		<input type="text" name="client-id" id="client-id" required>
		<input type="submit" name="search" value="Search">
	</form>
	
	<?php
	$portfolioFile = 'database/portfolio.csv';
	if(isset($_POST['search'])) {
		$client_id = $_POST['client-id'];
		$portfolios = array_map('str_getcsv', file($portfolioFile));
		$found_portfolio = false;
		foreach($portfolios as $portfolio) {
			if($portfolio[0] == $client_id) {
				$found_portfolio = true;
				$client_id = $portfolio[1];
				$portfolio_type = $portfolio[2];
				$portfolio_value = $portfolio[3];
				$portfolio_return = $portfolio[4];
				$portfolio_risk = $portfolio[5];
				break;
			}
		}
		if($found_portfolio) {
			echo '<form id="Application-Form" method="post" action="">';
			echo '<label for="client-id" style="margin: 10px; padding: 10px;">Client id:</label>';
			echo '<input type="text" name="client-name" id="name" value="'.$client_name.'" required><br>';
			echo '<label for="portfolio-type" style="margin: 10px; padding: 10px;">Portfolio Type:</label>';
			echo '<input type="text" name="portfolio-type" id="portfolio-type" value="'.$portfolio_type.'" required><br>';
			echo '<label for="portfolio-value" style="margin: 10px; padding: 10px;">Portfolio Value:</label>';
			echo '<input type="text" name="portfolio-value" id="portfolio-value" value="'.$portfolio_value.'" required><br>';
			echo '<label for="portfolio-return" style="margin: 10px; padding: 10px;">Portfolio Return:</label>';
			echo '<input type="text" name="portfolio-return" id="portfolio-return" value="'.$portfolio_return.'" required><br>';
			echo '<label for="portfolio-risk" style="margin: 10px; padding: 10px;">Portfolio Risk:</label>';
			echo '<input type="text" name="portfolio-risk" id="portfolio-risk" value="'.$portfolio_risk.'" required><br>';
			echo '<input type="hidden" name="id" value="'.$client_id.'">';
			echo '<input type="submit" name="save" value="Save">';
			echo '</form>';
		} else {
			echo 'Portfolio not found.';
		}
	}
	$portfolioFile = 'database/portfolio.csv';
	if(isset($_POST['save'])) {
		$client_id = $_POST['id'];
		$client_name = $_POST['client-name'];
		$portfolio_type = $_POST['portfolio-type'];
		$portfolio_value = $_POST['portfolio-value'];
		$portfolio_return = $_POST['portfolio-return'];
		$portfolio_risk = $_POST['portfolio-risk'];

		$portfolios = array_map('str_getcsv', file($portfolioFile));
		$updated_portfolio = false;
		foreach($portfolios as &$portfolio) {
			if($portfolio[0] == $client_id) {
				$portfolio[1] = $client_name;
        $portfolio[2] = $client_email;
        $updated_portfolio = true;
        break;
      }
    }
    if($updated_portfolio) {
      $fp = fopen($portfolioFile, 'w');
      foreach($portfolios as $portfolio) {
        fputcsv($fp, $portfolio);
      }
      fclose($fp);
      echo "Portfolio for client $client_id has been updated.";
    } else {
      echo "Portfolio for client $client_id could not be found.";
    }
  } else {
    echo "Client ID, name, and email must all be provided.";
  }
  ?>

    <footer>
      <div class="container-fluid">
        <i class="social-icon fab fa-facebook-f"></i>
        <i class="social-icon fab fa-twitter"></i>
        <i class="social-icon fab fa-instagram"></i>
        <i class="social-icon fas fa-envelope"></i>
        <p>©Swinburne University Submission ©By</p>
      </div>
    </footer>

    <script src="./scripts/apply.js"></script>
    <script src="./scripts/dropdown.js"></script>
    <!-- Option 1: Bootstrap Bundle with Popper -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
      crossorigin="anonymous"
    ></script>

    <script src="./scripts/apply.js"></script>
    <script src="./scripts/dropdown.js"></script>
    <!-- Option 1: Bootstrap Bundle with Popper -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
      crossorigin="anonymous"
    ></script>
</body>
</html>
